// Generated by CoffeeScript 1.12.7
(function() {
  var LessCache, _, basename, cacheVersion, crypto, dirname, extname, fs, join, less, lessFs, ref, relative, walkdir,
    slice = [].slice;

  crypto = require('crypto');

  ref = require('path'), basename = ref.basename, dirname = ref.dirname, extname = ref.extname, join = ref.join, relative = ref.relative;

  _ = require('underscore-plus');

  fs = require('fs-plus');

  less = null;

  lessFs = null;

  walkdir = require('walkdir').sync;

  cacheVersion = 1;

  module.exports = LessCache = (function() {
    LessCache.digestForContent = function(content) {
      return crypto.createHash('SHA1').update(content, 'utf8').digest('hex');
    };

    function LessCache(params) {
      if (params == null) {
        params = {};
      }
      this.cacheDir = params.cacheDir, this.importPaths = params.importPaths, this.resourcePath = params.resourcePath, this.fallbackDir = params.fallbackDir, this.syncCaches = params.syncCaches, this.lessSourcesByRelativeFilePath = params.lessSourcesByRelativeFilePath, this.importedFilePathsByRelativeImportPath = params.importedFilePathsByRelativeImportPath;
      if (this.lessSourcesByRelativeFilePath == null) {
        this.lessSourcesByRelativeFilePath = {};
      }
      if (this.importedFilePathsByRelativeImportPath == null) {
        this.importedFilePathsByRelativeImportPath = {};
      }
      this.importsCacheDir = this.cacheDirectoryForImports(this.importPaths);
      if (this.fallbackDir) {
        this.importsFallbackDir = join(this.fallbackDir, basename(this.importsCacheDir));
      }
      try {
        this.importedFiles = this.readJson(join(this.importsCacheDir, 'imports.json')).importedFiles;
      } catch (error1) {}
      this.setImportPaths(this.importPaths);
      this.stats = {
        hits: 0,
        misses: 0
      };
    }

    LessCache.prototype.cacheDirectoryForImports = function(importPaths) {
      if (importPaths == null) {
        importPaths = [];
      }
      if (this.resourcePath) {
        importPaths = importPaths.map((function(_this) {
          return function(importPath) {
            return _this.relativize(_this.resourcePath, importPath);
          };
        })(this));
      }
      return join(this.cacheDir, LessCache.digestForContent(importPaths.join('\n')));
    };

    LessCache.prototype.getDirectory = function() {
      return this.cacheDir;
    };

    LessCache.prototype.getImportPaths = function() {
      return _.clone(this.importPaths);
    };

    LessCache.prototype.getImportedFiles = function(importPaths) {
      var absoluteImportPath, error, i, importPath, importedFilePaths, importedFiles, len;
      importedFiles = [];
      for (i = 0, len = importPaths.length; i < len; i++) {
        absoluteImportPath = importPaths[i];
        importPath = null;
        if (this.resourcePath != null) {
          importPath = this.relativize(this.resourcePath, absoluteImportPath);
        } else {
          importPath = absoluteImportPath;
        }
        importedFilePaths = this.importedFilePathsByRelativeImportPath[importPath];
        if (importedFilePaths != null) {
          importedFiles = importedFiles.concat(importedFilePaths);
        } else {
          try {
            walkdir(absoluteImportPath, {
              no_return: true
            }, (function(_this) {
              return function(filePath, stat) {
                if (!stat.isFile()) {
                  return;
                }
                if (_this.resourcePath != null) {
                  return importedFiles.push(_this.relativize(_this.resourcePath, filePath));
                } else {
                  return importedFiles.push(filePath);
                }
              };
            })(this));
          } catch (error1) {
            error = error1;
            continue;
          }
        }
      }
      return importedFiles;
    };

    LessCache.prototype.setImportPaths = function(importPaths) {
      var error, filesChanged, importedFiles, pathsChanged;
      if (importPaths == null) {
        importPaths = [];
      }
      importedFiles = this.getImportedFiles(importPaths);
      pathsChanged = !_.isEqual(this.importPaths, importPaths);
      filesChanged = !_.isEqual(this.importedFiles, importedFiles);
      if (pathsChanged) {
        this.importsCacheDir = this.cacheDirectoryForImports(importPaths);
        if (this.fallbackDir) {
          this.importsFallbackDir = join(this.fallbackDir, basename(this.importsCacheDir));
        }
      } else if (filesChanged) {
        try {
          fs.removeSync(this.importsCacheDir);
        } catch (error1) {
          error = error1;
          if ((error != null ? error.code : void 0) === 'ENOENT') {
            try {
              fs.removeSync(this.importsCacheDir);
            } catch (error1) {}
          }
        }
      }
      this.writeJson(join(this.importsCacheDir, 'imports.json'), {
        importedFiles: importedFiles
      });
      this.importedFiles = importedFiles;
      return this.importPaths = importPaths;
    };

    LessCache.prototype.observeImportedFilePaths = function(callback) {
      var importedPaths, originalFsReadFileSync;
      importedPaths = [];
      if (lessFs == null) {
        lessFs = require('less/lib/less-node/fs.js');
      }
      originalFsReadFileSync = lessFs.readFileSync;
      lessFs.readFileSync = (function(_this) {
        return function() {
          var args, content, digest, filePath, lessSource, relativeFilePath;
          filePath = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
          if (_this.resourcePath) {
            relativeFilePath = _this.relativize(_this.resourcePath, filePath);
          }
          lessSource = _this.lessSourcesByRelativeFilePath[relativeFilePath];
          content = null;
          digest = null;
          if (lessSource != null) {
            content = lessSource.content;
            digest = lessSource.digest;
          } else {
            content = originalFsReadFileSync.apply(null, [filePath].concat(slice.call(args)));
            digest = LessCache.digestForContent(content);
          }
          importedPaths.push({
            path: relativeFilePath != null ? relativeFilePath : filePath,
            digest: digest
          });
          return content;
        };
      })(this);
      try {
        callback();
      } finally {
        lessFs.readFileSync = originalFsReadFileSync;
      }
      return importedPaths;
    };

    LessCache.prototype.readJson = function(filePath) {
      return JSON.parse(fs.readFileSync(filePath));
    };

    LessCache.prototype.writeJson = function(filePath, object) {
      return fs.writeFileSync(filePath, JSON.stringify(object));
    };

    LessCache.prototype.digestForPath = function(relativeFilePath) {
      var absoluteFilePath, lessSource;
      lessSource = this.lessSourcesByRelativeFilePath[relativeFilePath];
      if (lessSource != null) {
        return lessSource.digest;
      } else {
        absoluteFilePath = null;
        if (this.resourcePath && !fs.isAbsolute(relativeFilePath)) {
          absoluteFilePath = join(this.resourcePath, relativeFilePath);
        } else {
          absoluteFilePath = relativeFilePath;
        }
        return LessCache.digestForContent(fs.readFileSync(absoluteFilePath));
      }
    };

    LessCache.prototype.relativize = function(from, to) {
      var relativePath;
      relativePath = relative(from, to);
      if (relativePath.indexOf('..') === 0) {
        return to;
      } else {
        return relativePath;
      }
    };

    LessCache.prototype.getCachePath = function(directory, filePath) {
      var cacheFile, directoryPath;
      cacheFile = (basename(filePath, extname(filePath))) + ".json";
      directoryPath = dirname(filePath);
      if (this.resourcePath) {
        directoryPath = this.relativize(this.resourcePath, directoryPath);
      }
      if (directoryPath) {
        directoryPath = LessCache.digestForContent(directoryPath);
      }
      return join(directory, 'content', directoryPath, cacheFile);
    };

    LessCache.prototype.getCachedCss = function(filePath, digest) {
      var cacheEntry, error, fallbackDirUsed, i, len, path, ref1, ref2;
      try {
        cacheEntry = this.readJson(this.getCachePath(this.importsCacheDir, filePath));
      } catch (error1) {
        error = error1;
        if (this.importsFallbackDir != null) {
          try {
            cacheEntry = this.readJson(this.getCachePath(this.importsFallbackDir, filePath));
            fallbackDirUsed = true;
          } catch (error1) {}
        }
      }
      if (digest !== (cacheEntry != null ? cacheEntry.digest : void 0)) {
        return;
      }
      ref1 = cacheEntry.imports;
      for (i = 0, len = ref1.length; i < len; i++) {
        ref2 = ref1[i], path = ref2.path, digest = ref2.digest;
        try {
          if (this.digestForPath(path) !== digest) {
            return;
          }
        } catch (error1) {
          error = error1;
          return;
        }
      }
      if (this.syncCaches) {
        if (fallbackDirUsed) {
          this.writeJson(this.getCachePath(this.importsCacheDir, filePath), cacheEntry);
        } else if (this.importsFallbackDir != null) {
          this.writeJson(this.getCachePath(this.importsFallbackDir, filePath), cacheEntry);
        }
      }
      return cacheEntry.css;
    };

    LessCache.prototype.putCachedCss = function(filePath, digest, css, imports) {
      var cacheEntry;
      cacheEntry = {
        digest: digest,
        css: css,
        imports: imports,
        version: cacheVersion
      };
      this.writeJson(this.getCachePath(this.importsCacheDir, filePath), cacheEntry);
      if (this.syncCaches && (this.importsFallbackDir != null)) {
        return this.writeJson(this.getCachePath(this.importsFallbackDir, filePath), cacheEntry);
      }
    };

    LessCache.prototype.parseLess = function(filePath, contents) {
      var css, imports, options;
      css = null;
      options = {
        filename: filePath,
        syncImport: true,
        javascriptEnabled: true,
        paths: this.importPaths
      };
      if (less == null) {
        less = require('less');
      }
      imports = this.observeImportedFilePaths(function() {
        return less.render(contents, options, function(error, result) {
          if (error != null) {
            throw error;
          } else {
            return css = result.css, result;
          }
        });
      });
      return {
        imports: imports,
        css: css
      };
    };

    LessCache.prototype.readFileSync = function(absoluteFilePath) {
      var lessSource, relativeFilePath;
      lessSource = null;
      if (this.resourcePath && fs.isAbsolute(absoluteFilePath)) {
        relativeFilePath = this.relativize(this.resourcePath, absoluteFilePath);
        lessSource = this.lessSourcesByRelativeFilePath[relativeFilePath];
      }
      if (lessSource != null) {
        return this.cssForFile(absoluteFilePath, lessSource.content, lessSource.digest);
      } else {
        return this.cssForFile(absoluteFilePath, fs.readFileSync(absoluteFilePath, 'utf8'));
      }
    };

    LessCache.prototype.cssForFile = function(filePath, lessContent, digest) {
      var css, imports, ref1;
      if (digest == null) {
        digest = LessCache.digestForContent(lessContent);
      }
      css = this.getCachedCss(filePath, digest);
      if (css != null) {
        this.stats.hits++;
        return css;
      }
      this.stats.misses++;
      ref1 = this.parseLess(filePath, lessContent), imports = ref1.imports, css = ref1.css;
      this.putCachedCss(filePath, digest, css, imports);
      return css;
    };

    return LessCache;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVzcy1jYWNoZS5qcyIsInNvdXJjZVJvb3QiOiIuLiIsInNvdXJjZXMiOlsibGliL2xlc3MtY2FjaGUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUFBLE1BQUEsOEdBQUE7SUFBQTs7RUFBQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFFBQVI7O0VBQ1QsTUFBK0MsT0FBQSxDQUFRLE1BQVIsQ0FBL0MsRUFBQyx1QkFBRCxFQUFXLHFCQUFYLEVBQW9CLHFCQUFwQixFQUE2QixlQUE3QixFQUFtQzs7RUFFbkMsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxpQkFBUjs7RUFDSixFQUFBLEdBQUssT0FBQSxDQUFRLFNBQVI7O0VBQ0wsSUFBQSxHQUFPOztFQUNQLE1BQUEsR0FBUzs7RUFDVCxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVIsQ0FBa0IsQ0FBQzs7RUFFN0IsWUFBQSxHQUFlOztFQUVmLE1BQU0sQ0FBQyxPQUFQLEdBQ007SUFDSixTQUFDLENBQUEsZ0JBQUQsR0FBbUIsU0FBQyxPQUFEO2FBQ2pCLE1BQU0sQ0FBQyxVQUFQLENBQWtCLE1BQWxCLENBQXlCLENBQUMsTUFBMUIsQ0FBaUMsT0FBakMsRUFBMEMsTUFBMUMsQ0FBaUQsQ0FBQyxNQUFsRCxDQUF5RCxLQUF6RDtJQURpQjs7SUFnQk4sbUJBQUMsTUFBRDs7UUFBQyxTQUFPOztNQUVqQixJQUFDLENBQUEsa0JBQUEsUUFESCxFQUNhLElBQUMsQ0FBQSxxQkFBQSxXQURkLEVBQzJCLElBQUMsQ0FBQSxzQkFBQSxZQUQ1QixFQUMwQyxJQUFDLENBQUEscUJBQUEsV0FEM0MsRUFDd0QsSUFBQyxDQUFBLG9CQUFBLFVBRHpELEVBRUUsSUFBQyxDQUFBLHVDQUFBLDZCQUZILEVBRWtDLElBQUMsQ0FBQSwrQ0FBQTs7UUFHbkMsSUFBQyxDQUFBLGdDQUFpQzs7O1FBQ2xDLElBQUMsQ0FBQSx3Q0FBeUM7O01BQzFDLElBQUMsQ0FBQSxlQUFELEdBQW1CLElBQUMsQ0FBQSx3QkFBRCxDQUEwQixJ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O1FBQUEsU0FBVSxTQUFTLENBQUMsZ0JBQVYsQ0FBMkIsV0FBM0I7O01BQ1YsR0FBQSxHQUFNLElBQUMsQ0FBQSxZQUFELENBQWMsUUFBZCxFQUF3QixNQUF4QjtNQUNOLElBQUcsV0FBSDtRQUNFLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUDtBQUNBLGVBQU8sSUFGVDs7TUFJQSxJQUFDLENBQUEsS0FBSyxDQUFDLE1BQVA7TUFDQSxPQUFpQixJQUFDLENBQUEsU0FBRCxDQUFXLFFBQVgsRUFBcUIsV0FBckIsQ0FBakIsRUFBQyxzQkFBRCxFQUFVO01BQ1YsSUFBQyxDQUFBLFlBQUQsQ0FBYyxRQUFkLEVBQXdCLE1BQXhCLEVBQWdDLEdBQWhDLEVBQXFDLE9BQXJDO2FBQ0E7SUFWVTs7Ozs7QUF6T2QiLCJzb3VyY2VzQ29udGVudCI6WyJjcnlwdG8gPSByZXF1aXJlICdjcnlwdG8nXG57YmFzZW5hbWUsIGRpcm5hbWUsIGV4dG5hbWUsIGpvaW4sIHJlbGF0aXZlfSA9IHJlcXVpcmUgJ3BhdGgnXG5cbl8gPSByZXF1aXJlICd1bmRlcnNjb3JlLXBsdXMnXG5mcyA9IHJlcXVpcmUgJ2ZzLXBsdXMnXG5sZXNzID0gbnVsbCAjIERlZmVyIHVudGlsIGl0IGlzIGFjdHVhbGx5IHVzZWRcbmxlc3NGcyA9IG51bGwgIyBEZWZlciB1bnRpbCBpdCBpcyBhY3R1YWxseSB1c2VkXG53YWxrZGlyID0gcmVxdWlyZSgnd2Fsa2RpcicpLnN5bmNcblxuY2FjaGVWZXJzaW9uID0gMVxuXG5tb2R1bGUuZXhwb3J0cyA9XG5jbGFzcyBMZXNzQ2FjaGVcbiAgQGRpZ2VzdEZvckNvbnRlbnQ6IChjb250ZW50KSAtPlxuICAgIGNyeXB0by5jcmVhdGVIYXNoKCdTSEExJykudXBkYXRlKGNvbnRlbnQsICd1dGY4JykuZGlnZXN0KCdoZXgnKVxuXG4gICMgQ3JlYXRlIGEgbmV3IExlc3MgY2FjaGUgd2l0aCB0aGUgZ2l2ZW4gb3B0aW9ucy5cbiAgI1xuICAjIG9wdGlvbnMgLSBBbiBvYmplY3Qgd2l0aCBmb2xsb3dpbmcga2V5c1xuICAjICAgKiBjYWNoZURpcjogQSBzdHJpbmcgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHRvIHN0b3JlIGNhY2hlZCBmaWxlcyBpbiAocmVxdWlyZWQpXG4gICNcbiAgIyAgICogaW1wb3J0UGF0aHM6IEFuIGFycmF5IG9mIHN0cmluZ3MgdG8gY29uZmlndXJlIHRoZSBMZXNzIHBhcnNlciB3aXRoIChvcHRpb25hbClcbiAgI1xuICAjICAgKiByZXNvdXJjZVBhdGg6IEEgc3RyaW5nIHBhdGggdG8gdXNlIGZvciByZWxhdGl2aXppbmcgcGF0aHMuIFRoaXMgaXMgdXNlZnVsIGlmXG4gICMgICAgICAgICAgICAgICAgICAgeW91IHdhbnQgdG8gbWFrZSBjYWNoZXMgdHJhbnNmZXJhYmxlIGJldHdlZW4gZGlyZWN0b3JpZXMgb3JcbiAgIyAgICAgICAgICAgICAgICAgICBtYWNoaW5lcy4gKG9wdGlvbmFsKVxuICAjXG4gICMgICAqIGZhbGxiYWNrRGlyOiBBIHN0cmluZyBwYXRoIHRvIGEgZGlyZWN0b3J5IGNvbnRhaW5pbmcgYSByZWFkYWJsZSBjYWNoZSB0byByZWFkXG4gICMgICAgICAgICAgICAgICAgICBmcm9tIGFuIGVudHJ5IGlzIG5vdCBmb3VuZCBpbiB0aGlzIGNhY2hlIChvcHRpb25hbClcbiAgY29uc3RydWN0b3I6IChwYXJhbXM9e30pIC0+XG4gICAge1xuICAgICAgQGNhY2hlRGlyLCBAaW1wb3J0UGF0aHMsIEByZXNvdXJjZVBhdGgsIEBmYWxsYmFja0RpciwgQHN5bmNDYWNoZXMsXG4gICAgICBAbGVzc1NvdXJjZXNCeVJlbGF0aXZlRmlsZVBhdGgsIEBpbXBvcnRlZEZpbGVQYXRoc0J5UmVsYXRpdmVJbXBvcnRQYXRoXG4gICAgfSA9IHBhcmFtc1xuXG4gICAgQGxlc3NTb3VyY2VzQnlSZWxhdGl2ZUZpbGVQYXRoID89IHt9XG4gICAgQGltcG9ydGVkRmlsZVBhdGhzQnlSZWxhdGl2ZUltcG9ydFBhdGggPz0ge31cbiAgICBAaW1wb3J0c0NhY2hlRGlyID0gQGNhY2hlRGlyZWN0b3J5Rm9ySW1wb3J0cyhAaW1wb3J0UGF0aHMpXG4gICAgaWYgQGZhbGxiYWNrRGlyXG4gICAgICBAaW1wb3J0c0ZhbGxiYWNrRGlyID0gam9pbihAZmFsbGJhY2tEaXIsIGJhc2VuYW1lKEBpbXBvcnRzQ2FjaGVEaXIpKVxuXG4gICAgdHJ5XG4gICAgICB7QGltcG9ydGVkRmlsZXN9ID0gQHJlYWRKc29uKGpvaW4oQGltcG9ydHNDYWNoZURpciwgJ2ltcG9ydHMuanNvbicpKVxuXG4gICAgQHNldEltcG9ydFBhdGhzKEBpbXBvcnRQYXRocylcblxuICAgIEBzdGF0cyA9XG4gICAgICBoaXRzOiAwXG4gICAgICBtaXNzZXM6IDBcblxuICBjYWNoZURpcmVjdG9yeUZvckltcG9ydHM6IChpbXBvcnRQYXRocz1bXSkgLT5cbiAgICBpZiBAcmVzb3VyY2VQYXRoXG4gICAgICBpbXBvcnRQYXRocyA9IGltcG9ydFBhdGhzLm1hcCAoaW1wb3J0UGF0aCkgPT5cbiAgICAgICAgQHJlbGF0aXZpemUoQHJlc291cmNlUGF0aCwgaW1wb3J0UGF0aClcbiAgICBqb2luKEBjYWNoZURpciwgTGVzc0NhY2hlLmRpZ2VzdEZvckNvbnRlbnQoaW1wb3J0UGF0aHMuam9pbignXFxuJykpKVxuXG4gIGdldERpcmVjdG9yeTogLT4gQGNhY2hlRGlyXG5cbiAgZ2V0SW1wb3J0UGF0aHM6IC0+IF8uY2xvbmUoQGltcG9ydFBhdGhzKVxuXG4gIGdldEltcG9ydGVkRmlsZXM6IChpbXBvcnRQYXRocykgLT5cbiAgICBpbXBvcnRlZEZpbGVzID0gW11cbiAgICBmb3IgYWJzb2x1dGVJbXBvcnRQYXRoIGluIGltcG9ydFBhdGhzXG4gICAgICBpbXBvcnRQYXRoID0gbnVsbFxuICAgICAgaWYgQHJlc291cmNlUGF0aD9cbiAgICAgICAgaW1wb3J0UGF0aCA9IEByZWxhdGl2aXplKEByZXNvdXJjZVBhdGgsIGFic29sdXRlSW1wb3J0UGF0aClcbiAgICAgIGVsc2VcbiAgICAgICAgaW1wb3J0UGF0aCA9IGFic29sdXRlSW1wb3J0UGF0aFxuXG4gICAgICBpbXBvcnRlZEZpbGVQYXRocyA9IEBpbXBvcnRlZEZpbGVQYXRoc0J5UmVsYXRpdmVJbXBvcnRQYXRoW2ltcG9ydFBhdGhdXG4gICAgICBpZiBpbXBvcnRlZEZpbGVQYXRocz9cbiAgICAgICAgaW1wb3J0ZWRGaWxlcyA9IGltcG9ydGVkRmlsZXMuY29uY2F0KGltcG9ydGVkRmlsZVBhdGhzKVxuICAgICAgZWxzZVxuICAgICAgICB0cnlcbiAgICAgICAgICB3YWxrZGlyIGFic29sdXRlSW1wb3J0UGF0aCwgbm9fcmV0dXJuOiB0cnVlLCAoZmlsZVBhdGgsIHN0YXQpID0+XG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIHN0YXQuaXNGaWxlKClcbiAgICAgICAgICAgIGlmIEByZXNvdXJjZVBhdGg/XG4gICAgICAgICAgICAgIGltcG9ydGVkRmlsZXMucHVzaChAcmVsYXRpdml6ZShAcmVzb3VyY2VQYXRoLCBmaWxlUGF0aCkpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgIGltcG9ydGVkRmlsZXMucHVzaChmaWxlUGF0aClcbiAgICAgICAgY2F0Y2ggZXJyb3JcbiAgICAgICAgICBjb250aW51ZVxuXG4gICAgaW1wb3J0ZWRGaWxlc1xuXG4gIHNldEltcG9ydFBhdGhzOiAoaW1wb3J0UGF0aHM9W10pIC0+XG4gICAgaW1wb3J0ZWRGaWxlcyA9IEBnZXRJbXBvcnRlZEZpbGVzKGltcG9ydFBhdGhzKVxuXG4gICAgcGF0aHNDaGFuZ2VkID0gbm90IF8uaXNFcXVhbChAaW1wb3J0UGF0aHMsIGltcG9ydFBhdGhzKVxuICAgIGZpbGVzQ2hhbmdlZCA9IG5vdCBfLmlzRXF1YWwoQGltcG9ydGVkRmlsZXMsIGltcG9ydGVkRmlsZXMpXG4gICAgaWYgcGF0aHNDaGFuZ2VkXG4gICAgICBAaW1wb3J0c0NhY2hlRGlyID0gQGNhY2hlRGlyZWN0b3J5Rm9ySW1wb3J0cyhpbXBvcnRQYXRocylcbiAgICAgIGlmIEBmYWxsYmFja0RpclxuICAgICAgICBAaW1wb3J0c0ZhbGxiYWNrRGlyID0gam9pbihAZmFsbGJhY2tEaXIsIGJhc2VuYW1lKEBpbXBvcnRzQ2FjaGVEaXIpKVxuICAgIGVsc2UgaWYgZmlsZXNDaGFuZ2VkXG4gICAgICB0cnlcbiAgICAgICAgZnMucmVtb3ZlU3luYyhAaW1wb3J0c0NhY2hlRGlyKVxuICAgICAgY2F0Y2ggZXJyb3JcbiAgICAgICAgaWYgZXJyb3I/LmNvZGUgaXMgJ0VOT0VOVCdcbiAgICAgICAgICB0cnlcbiAgICAgICAgICAgIGZzLnJlbW92ZVN5bmMoQGltcG9ydHNDYWNoZURpcikgIyBSZXRyeSBvbmNlXG5cbiAgICBAd3JpdGVKc29uKGpvaW4oQGltcG9ydHNDYWNoZURpciwgJ2ltcG9ydHMuanNvbicpLCB7aW1wb3J0ZWRGaWxlc30pXG5cbiAgICBAaW1wb3J0ZWRGaWxlcyA9IGltcG9ydGVkRmlsZXNcbiAgICBAaW1wb3J0UGF0aHMgPSBpbXBvcnRQYXRoc1xuXG4gIG9ic2VydmVJbXBvcnRlZEZpbGVQYXRoczogKGNhbGxiYWNrKSAtPlxuICAgIGltcG9ydGVkUGF0aHMgPSBbXVxuICAgIGxlc3NGcyA/PSByZXF1aXJlICdsZXNzL2xpYi9sZXNzLW5vZGUvZnMuanMnXG4gICAgb3JpZ2luYWxGc1JlYWRGaWxlU3luYyA9IGxlc3NGcy5yZWFkRmlsZVN5bmNcbiAgICBsZXNzRnMucmVhZEZpbGVTeW5jID0gKGZpbGVQYXRoLCBhcmdzLi4uKSA9PlxuICAgICAgcmVsYXRpdmVGaWxlUGF0aCA9IEByZWxhdGl2aXplKEByZXNvdXJjZVBhdGgsIGZpbGVQYXRoKSBpZiBAcmVzb3VyY2VQYXRoXG4gICAgICBsZXNzU291cmNlID0gQGxlc3NTb3VyY2VzQnlSZWxhdGl2ZUZpbGVQYXRoW3JlbGF0aXZlRmlsZVBhdGhdXG4gICAgICBjb250ZW50ID0gbnVsbFxuICAgICAgZGlnZXN0ID0gbnVsbFxuICAgICAgaWYgbGVzc1NvdXJjZT9cbiAgICAgICAgY29udGVudCA9IGxlc3NTb3VyY2UuY29udGVudFxuICAgICAgICBkaWdlc3QgPSBsZXNzU291cmNlLmRpZ2VzdFxuICAgICAgZWxzZVxuICAgICAgICBjb250ZW50ID0gb3JpZ2luYWxGc1JlYWRGaWxlU3luYyhmaWxlUGF0aCwgYXJncy4uLilcbiAgICAgICAgZGlnZXN0ID0gTGVzc0NhY2hlLmRpZ2VzdEZvckNvbnRlbnQoY29udGVudClcblxuICAgICAgaW1wb3J0ZWRQYXRocy5wdXNoKHtwYXRoOiByZWxhdGl2ZUZpbGVQYXRoID8gZmlsZVBhdGgsIGRpZ2VzdDogZGlnZXN0fSlcbiAgICAgIGNvbnRlbnRcblxuICAgIHRyeVxuICAgICAgY2FsbGJhY2soKVxuICAgIGZpbmFsbHlcbiAgICAgIGxlc3NGcy5yZWFkRmlsZVN5bmMgPSBvcmlnaW5hbEZzUmVhZEZpbGVTeW5jXG5cbiAgICBpbXBvcnRlZFBhdGhzXG5cbiAgcmVhZEpzb246IChmaWxlUGF0aCkgLT4gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgpKVxuXG4gIHdyaXRlSnNvbjogKGZpbGVQYXRoLCBvYmplY3QpIC0+IGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KG9iamVjdCkpXG5cbiAgZGlnZXN0Rm9yUGF0aDogKHJlbGF0aXZlRmlsZVBhdGgpIC0+XG4gICAgbGVzc1NvdXJjZSA9IEBsZXNzU291cmNlc0J5UmVsYXRpdmVGaWxlUGF0aFtyZWxhdGl2ZUZpbGVQYXRoXVxuICAgIGlmIGxlc3NTb3VyY2U/XG4gICAgICBsZXNzU291cmNlLmRpZ2VzdFxuICAgIGVsc2VcbiAgICAgIGFic29sdXRlRmlsZVBhdGggPSBudWxsXG4gICAgICBpZiBAcmVzb3VyY2VQYXRoIGFuZCBub3QgZnMuaXNBYnNvbHV0ZShyZWxhdGl2ZUZpbGVQYXRoKVxuICAgICAgICBhYnNvbHV0ZUZpbGVQYXRoID0gam9pbihAcmVzb3VyY2VQYXRoLCByZWxhdGl2ZUZpbGVQYXRoKVxuICAgICAgZWxzZVxuICAgICAgICBhYnNvbHV0ZUZpbGVQYXRoID0gcmVsYXRpdmVGaWxlUGF0aFxuICAgICAgTGVzc0NhY2hlLmRpZ2VzdEZvckNvbnRlbnQoZnMucmVhZEZpbGVTeW5jKGFic29sdXRlRmlsZVBhdGgpKVxuXG4gIHJlbGF0aXZpemU6IChmcm9tLCB0bykgLT5cbiAgICByZWxhdGl2ZVBhdGggPSByZWxhdGl2ZShmcm9tLCB0bylcbiAgICBpZiByZWxhdGl2ZVBhdGguaW5kZXhPZignLi4nKSBpcyAwXG4gICAgICB0b1xuICAgIGVsc2VcbiAgICAgIHJlbGF0aXZlUGF0aFxuXG4gIGdldENhY2hlUGF0aDogKGRpcmVjdG9yeSwgZmlsZVBhdGgpIC0+XG4gICAgY2FjaGVGaWxlID0gXCIje2Jhc2VuYW1lKGZpbGVQYXRoLCBleHRuYW1lKGZpbGVQYXRoKSl9Lmpzb25cIlxuICAgIGRpcmVjdG9yeVBhdGggPSBkaXJuYW1lKGZpbGVQYXRoKVxuICAgIGRpcmVjdG9yeVBhdGggPSBAcmVsYXRpdml6ZShAcmVzb3VyY2VQYXRoLCBkaXJlY3RvcnlQYXRoKSBpZiBAcmVzb3VyY2VQYXRoXG4gICAgZGlyZWN0b3J5UGF0aCA9IExlc3NDYWNoZS5kaWdlc3RGb3JDb250ZW50KGRpcmVjdG9yeVBhdGgpIGlmIGRpcmVjdG9yeVBhdGhcbiAgICBqb2luKGRpcmVjdG9yeSwgJ2NvbnRlbnQnLCBkaXJlY3RvcnlQYXRoLCBjYWNoZUZpbGUpXG5cbiAgZ2V0Q2FjaGVkQ3NzOiAoZmlsZVBhdGgsIGRpZ2VzdCkgLT5cbiAgICB0cnlcbiAgICAgIGNhY2hlRW50cnkgPSBAcmVhZEpzb24oQGdldENhY2hlUGF0aChAaW1wb3J0c0NhY2hlRGlyLCBmaWxlUGF0aCkpXG4gICAgY2F0Y2ggZXJyb3JcbiAgICAgIGlmIEBpbXBvcnRzRmFsbGJhY2tEaXI/XG4gICAgICAgIHRyeVxuICAgICAgICAgIGNhY2hlRW50cnkgPSBAcmVhZEpzb24oQGdldENhY2hlUGF0aChAaW1wb3J0c0ZhbGxiYWNrRGlyLCBmaWxlUGF0aCkpXG4gICAgICAgICAgZmFsbGJhY2tEaXJVc2VkID0gdHJ1ZVxuXG4gICAgcmV0dXJuIHVubGVzcyBkaWdlc3QgaXMgY2FjaGVFbnRyeT8uZGlnZXN0XG5cbiAgICBmb3Ige3BhdGgsIGRpZ2VzdH0gaW4gY2FjaGVFbnRyeS5pbXBvcnRzXG4gICAgICB0cnlcbiAgICAgICAgcmV0dXJuIGlmIEBkaWdlc3RGb3JQYXRoKHBhdGgpIGlzbnQgZGlnZXN0XG4gICAgICBjYXRjaCBlcnJvclxuICAgICAgICByZXR1cm5cblxuICAgIGlmIEBzeW5jQ2FjaGVzXG4gICAgICBpZiBmYWxsYmFja0RpclVzZWRcbiAgICAgICAgQHdyaXRlSnNvbihAZ2V0Q2FjaGVQYXRoKEBpbXBvcnRzQ2FjaGVEaXIsIGZpbGVQYXRoKSwgY2FjaGVFbnRyeSlcbiAgICAgIGVsc2UgaWYgQGltcG9ydHNGYWxsYmFja0Rpcj9cbiAgICAgICAgQHdyaXRlSnNvbihAZ2V0Q2FjaGVQYXRoKEBpbXBvcnRzRmFsbGJhY2tEaXIsIGZpbGVQYXRoKSwgY2FjaGVFbnRyeSlcblxuICAgIGNhY2hlRW50cnkuY3NzXG5cbiAgcHV0Q2FjaGVkQ3NzOiAoZmlsZVBhdGgsIGRpZ2VzdCwgY3NzLCBpbXBvcnRzKSAtPlxuICAgIGNhY2hlRW50cnkgPSB7ZGlnZXN0LCBjc3MsIGltcG9ydHMsIHZlcnNpb246IGNhY2hlVmVyc2lvbn1cbiAgICBAd3JpdGVKc29uKEBnZXRDYWNoZVBhdGgoQGltcG9ydHNDYWNoZURpciwgZmlsZVBhdGgpLCBjYWNoZUVudHJ5KVxuXG4gICAgaWYgQHN5bmNDYWNoZXMgYW5kIEBpbXBvcnRzRmFsbGJhY2tEaXI/XG4gICAgICBAd3JpdGVKc29uKEBnZXRDYWNoZVBhdGgoQGltcG9ydHNGYWxsYmFja0RpciwgZmlsZVBhdGgpLCBjYWNoZUVudHJ5KVxuXG4gIHBhcnNlTGVzczogKGZpbGVQYXRoLCBjb250ZW50cykgLT5cbiAgICBjc3MgPSBudWxsXG4gICAgb3B0aW9ucyA9IGZpbGVuYW1lOiBmaWxlUGF0aCwgc3luY0ltcG9ydDogdHJ1ZSwgamF2YXNjcmlwdEVuYWJsZWQ6IHRydWUsIHBhdGhzOiBAaW1wb3J0UGF0aHNcbiAgICBsZXNzID89IHJlcXVpcmUoJ2xlc3MnKVxuICAgIGltcG9ydHMgPSBAb2JzZXJ2ZUltcG9ydGVkRmlsZVBhdGhzIC0+XG4gICAgICBsZXNzLnJlbmRlciBjb250ZW50cywgb3B0aW9ucywgKGVycm9yLCByZXN1bHQpIC0+XG4gICAgICAgIGlmIGVycm9yP1xuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIGVsc2VcbiAgICAgICAgICB7Y3NzfSA9IHJlc3VsdFxuICAgIHtpbXBvcnRzLCBjc3N9XG5cbiAgIyBSZWFkIHRoZSBMZXNzIGZpbGUgYXQgdGhlIGN1cnJlbnQgcGF0aCBhbmQgcmV0dXJuIGVpdGhlciB0aGUgY2FjaGVkIENTUyBvciB0aGUgbmV3bHlcbiAgIyBjb21waWxlZCBDU1MuIFRoaXMgbWV0aG9kIGNhY2hlcyB0aGUgY29tcGlsZWQgQ1NTIGFmdGVyIGl0IGlzIGdlbmVyYXRlZC4gVGhpcyBjYWNoZWRcbiAgIyBDU1Mgd2lsbCBiZSByZXR1cm5lZCBhcyBsb25nIGFzIHRoZSBMZXNzIGZpbGUgYW5kIGFueSBvZiBpdHMgaW1wb3J0cyBhcmUgdW5jaGFuZ2VkLlxuICAjXG4gICMgZmlsZVBhdGg6IEEgc3RyaW5nIHBhdGggdG8gYSBMZXNzIGZpbGUuXG4gICNcbiAgIyBSZXR1cm5zIHRoZSBjb21waWxlZCBDU1MgZm9yIHRoZSBnaXZlbiBwYXRoLlxuICByZWFkRmlsZVN5bmM6IChhYnNvbHV0ZUZpbGVQYXRoKSAtPlxuICAgIGxlc3NTb3VyY2UgPSBudWxsXG4gICAgaWYgQHJlc291cmNlUGF0aCBhbmQgZnMuaXNBYnNvbHV0ZShhYnNvbHV0ZUZpbGVQYXRoKVxuICAgICAgcmVsYXRpdmVGaWxlUGF0aCA9IEByZWxhdGl2aXplKEByZXNvdXJjZVBhdGgsIGFic29sdXRlRmlsZVBhdGgpXG4gICAgICBsZXNzU291cmNlID0gQGxlc3NTb3VyY2VzQnlSZWxhdGl2ZUZpbGVQYXRoW3JlbGF0aXZlRmlsZVBhdGhdXG5cbiAgICBpZiBsZXNzU291cmNlP1xuICAgICAgQGNzc0ZvckZpbGUoYWJzb2x1dGVGaWxlUGF0aCwgbGVzc1NvdXJjZS5jb250ZW50LCBsZXNzU291cmNlLmRpZ2VzdClcbiAgICBlbHNlXG4gICAgICBAY3NzRm9yRmlsZShhYnNvbHV0ZUZpbGVQYXRoLCBmcy5yZWFkRmlsZVN5bmMoYWJzb2x1dGVGaWxlUGF0aCwgJ3V0ZjgnKSlcblxuICAjIFJldHVybiBlaXRoZXIgY2FjaGVkIENTUyBvciB0aGUgbmV3bHlcbiAgIyBjb21waWxlZCBDU1MgZnJvbSBgbGVzc0NvbnRlbnRgLiBUaGlzIG1ldGhvZCBjYWNoZXMgdGhlIGNvbXBpbGVkIENTUyBhZnRlciBpdCBpcyBnZW5lcmF0ZWQuIFRoaXMgY2FjaGVkXG4gICMgQ1NTIHdpbGwgYmUgcmV0dXJuZWQgYXMgbG9uZyBhcyB0aGUgTGVzcyBmaWxlIGFuZCBhbnkgb2YgaXRzIGltcG9ydHMgYXJlIHVuY2hhbmdlZC5cbiAgI1xuICAjIGZpbGVQYXRoOiBBIHN0cmluZyBwYXRoIHRvIHRoZSBMZXNzIGZpbGUuXG4gICMgbGVzc0NvbnRlbnQ6IFRoZSBjb250ZW50cyBvZiB0aGUgZmlsZVBhdGhcbiAgI1xuICAjIFJldHVybnMgdGhlIGNvbXBpbGVkIENTUyBmb3IgdGhlIGdpdmVuIHBhdGggYW5kIGxlc3NDb250ZW50XG4gIGNzc0ZvckZpbGU6IChmaWxlUGF0aCwgbGVzc0NvbnRlbnQsIGRpZ2VzdCkgLT5cbiAgICBkaWdlc3QgPz0gTGVzc0NhY2hlLmRpZ2VzdEZvckNvbnRlbnQobGVzc0NvbnRlbnQpXG4gICAgY3NzID0gQGdldENhY2hlZENzcyhmaWxlUGF0aCwgZGlnZXN0KVxuICAgIGlmIGNzcz9cbiAgICAgIEBzdGF0cy5oaXRzKytcbiAgICAgIHJldHVybiBjc3NcblxuICAgIEBzdGF0cy5taXNzZXMrK1xuICAgIHtpbXBvcnRzLCBjc3N9ID0gQHBhcnNlTGVzcyhmaWxlUGF0aCwgbGVzc0NvbnRlbnQpXG4gICAgQHB1dENhY2hlZENzcyhmaWxlUGF0aCwgZGlnZXN0LCBjc3MsIGltcG9ydHMpXG4gICAgY3NzXG4iXX0=
//# sourceURL=/home/alex/bin/less-cache-ng/lib/less-cache.coffee