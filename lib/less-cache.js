// Generated by CoffeeScript 1.12.7
(function() {
  var LessCache, _, basename, cacheVersion, crypto, dirname, extname, fs, join, less, lessFs, ref, relative, walkdir,
    slice = [].slice;

  crypto = require('crypto');

  ref = require('path'), basename = ref.basename, dirname = ref.dirname, extname = ref.extname, join = ref.join, relative = ref.relative;

  _ = require('underscore-plus');

  fs = require('fs-plus');

  less = null;

  lessFs = null;

  walkdir = require('walkdir').sync;

  cacheVersion = 1;

  module.exports = LessCache = (function() {
    LessCache.digestForContent = function(content) {
      return crypto.createHash('SHA1').update(content, 'utf8').digest('hex');
    };

    function LessCache(params) {
      if (params == null) {
        params = {};
      }
      this.cacheDir = params.cacheDir, this.importPaths = params.importPaths, this.resourcePath = params.resourcePath, this.fallbackDir = params.fallbackDir, this.syncCaches = params.syncCaches, this.lessSourcesByRelativeFilePath = params.lessSourcesByRelativeFilePath, this.importedFilePathsByRelativeImportPath = params.importedFilePathsByRelativeImportPath;
      if (this.lessSourcesByRelativeFilePath == null) {
        this.lessSourcesByRelativeFilePath = {};
      }
      if (this.importedFilePathsByRelativeImportPath == null) {
        this.importedFilePathsByRelativeImportPath = {};
      }
      this.importsCacheDir = this.cacheDirectoryForImports(this.importPaths);
      if (this.fallbackDir) {
        this.importsFallbackDir = join(this.fallbackDir, basename(this.importsCacheDir));
      }
      try {
        this.importedFiles = this.readJson(join(this.importsCacheDir, 'imports.json')).importedFiles;
      } catch (error1) {}
      this.setImportPaths(this.importPaths);
      this.stats = {
        hits: 0,
        misses: 0
      };
    }

    LessCache.prototype.cacheDirectoryForImports = function(importPaths) {
      if (importPaths == null) {
        importPaths = [];
      }
      if (this.resourcePath) {
        importPaths = importPaths.map((function(_this) {
          return function(importPath) {
            return _this.relativize(_this.resourcePath, importPath);
          };
        })(this));
      }
      return join(this.cacheDir, LessCache.digestForContent(importPaths.join('\n')));
    };

    LessCache.prototype.getDirectory = function() {
      return this.cacheDir;
    };

    LessCache.prototype.getImportPaths = function() {
      return _.clone(this.importPaths);
    };

    LessCache.prototype.getImportedFiles = function(importPaths) {
      var absoluteImportPath, error, i, importPath, importedFilePaths, importedFiles, len;
      importedFiles = [];
      for (i = 0, len = importPaths.length; i < len; i++) {
        absoluteImportPath = importPaths[i];
        importPath = null;
        if (this.resourcePath != null) {
          importPath = this.relativize(this.resourcePath, absoluteImportPath);
        } else {
          importPath = absoluteImportPath;
        }
        importedFilePaths = this.importedFilePathsByRelativeImportPath[importPath];
        if (importedFilePaths != null) {
          importedFiles = importedFiles.concat(importedFilePaths);
        } else {
          try {
            walkdir(absoluteImportPath, {
              no_return: true
            }, (function(_this) {
              return function(filePath, stat) {
                if (!stat.isFile()) {
                  return;
                }
                if (_this.resourcePath != null) {
                  return importedFiles.push(_this.relativize(_this.resourcePath, filePath));
                } else {
                  return importedFiles.push(filePath);
                }
              };
            })(this));
          } catch (error1) {
            error = error1;
            continue;
          }
        }
      }
      return importedFiles;
    };

    LessCache.prototype.setImportPaths = function(importPaths) {
      var error, filesChanged, importedFiles, pathsChanged;
      if (importPaths == null) {
        importPaths = [];
      }
      importedFiles = this.getImportedFiles(importPaths);
      pathsChanged = !_.isEqual(this.importPaths, importPaths);
      filesChanged = !_.isEqual(this.importedFiles, importedFiles);
      if (pathsChanged) {
        this.importsCacheDir = this.cacheDirectoryForImports(importPaths);
        if (this.fallbackDir) {
          this.importsFallbackDir = join(this.fallbackDir, basename(this.importsCacheDir));
        }
      } else if (filesChanged) {
        try {
          fs.removeSync(this.importsCacheDir);
        } catch (error1) {
          error = error1;
          if ((error != null ? error.code : void 0) === 'ENOENT') {
            try {
              fs.removeSync(this.importsCacheDir);
            } catch (error1) {}
          }
        }
      }
      this.writeJson(join(this.importsCacheDir, 'imports.json'), {
        importedFiles: importedFiles
      });
      this.importedFiles = importedFiles;
      return this.importPaths = importPaths;
    };

    LessCache.prototype.observeImportedFilePaths = function(callback) {
      var importedPaths, originalFsReadFileSync;
      importedPaths = [];
      if (less === null) {
        less = require('less');
        lessFs = less.fs;
      } else if (lessFs === null) {
        lessFs = less.fs;
      }
      originalFsReadFileSync = lessFs.readFileSync;
      lessFs.readFileSync = (function(_this) {
        return function() {
          var args, content, digest, filePath, lessSource, relativeFilePath;
          filePath = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
          if (_this.resourcePath) {
            relativeFilePath = _this.relativize(_this.resourcePath, filePath);
          }
          lessSource = _this.lessSourcesByRelativeFilePath[relativeFilePath];
          content = null;
          digest = null;
          if (lessSource != null) {
            content = lessSource.content;
            digest = lessSource.digest;
          } else {
            content = originalFsReadFileSync.apply(null, [filePath].concat(slice.call(args)));
            digest = LessCache.digestForContent(content);
          }
          importedPaths.push({
            path: relativeFilePath != null ? relativeFilePath : filePath,
            digest: digest
          });
          return content;
        };
      })(this);
      try {
        callback();
      } finally {
        lessFs.readFileSync = originalFsReadFileSync;
      }
      return importedPaths;
    };

    LessCache.prototype.readJson = function(filePath) {
      return JSON.parse(fs.readFileSync(filePath));
    };

    LessCache.prototype.writeJson = function(filePath, object) {
      return fs.writeFileSync(filePath, JSON.stringify(object));
    };

    LessCache.prototype.digestForPath = function(relativeFilePath) {
      var absoluteFilePath, lessSource;
      lessSource = this.lessSourcesByRelativeFilePath[relativeFilePath];
      if (lessSource != null) {
        return lessSource.digest;
      } else {
        absoluteFilePath = null;
        if (this.resourcePath && !fs.isAbsolute(relativeFilePath)) {
          absoluteFilePath = join(this.resourcePath, relativeFilePath);
        } else {
          absoluteFilePath = relativeFilePath;
        }
        return LessCache.digestForContent(fs.readFileSync(absoluteFilePath));
      }
    };

    LessCache.prototype.relativize = function(from, to) {
      var relativePath;
      relativePath = relative(from, to);
      if (relativePath.indexOf('..') === 0) {
        return to;
      } else {
        return relativePath;
      }
    };

    LessCache.prototype.getCachePath = function(directory, filePath) {
      var cacheFile, directoryPath;
      cacheFile = (basename(filePath, extname(filePath))) + ".json";
      directoryPath = dirname(filePath);
      if (this.resourcePath) {
        directoryPath = this.relativize(this.resourcePath, directoryPath);
      }
      if (directoryPath) {
        directoryPath = LessCache.digestForContent(directoryPath);
      }
      return join(directory, 'content', directoryPath, cacheFile);
    };

    LessCache.prototype.getCachedCss = function(filePath, digest) {
      var cacheEntry, error, fallbackDirUsed, i, len, path, ref1, ref2;
      try {
        cacheEntry = this.readJson(this.getCachePath(this.importsCacheDir, filePath));
      } catch (error1) {
        error = error1;
        if (this.importsFallbackDir != null) {
          try {
            cacheEntry = this.readJson(this.getCachePath(this.importsFallbackDir, filePath));
            fallbackDirUsed = true;
          } catch (error1) {}
        }
      }
      if (digest !== (cacheEntry != null ? cacheEntry.digest : void 0)) {
        return;
      }
      ref1 = cacheEntry.imports;
      for (i = 0, len = ref1.length; i < len; i++) {
        ref2 = ref1[i], path = ref2.path, digest = ref2.digest;
        try {
          if (this.digestForPath(path) !== digest) {
            return;
          }
        } catch (error1) {
          error = error1;
          return;
        }
      }
      if (this.syncCaches) {
        if (fallbackDirUsed) {
          this.writeJson(this.getCachePath(this.importsCacheDir, filePath), cacheEntry);
        } else if (this.importsFallbackDir != null) {
          this.writeJson(this.getCachePath(this.importsFallbackDir, filePath), cacheEntry);
        }
      }
      return cacheEntry.css;
    };

    LessCache.prototype.putCachedCss = function(filePath, digest, css, imports) {
      var cacheEntry;
      cacheEntry = {
        digest: digest,
        css: css,
        imports: imports,
        version: cacheVersion
      };
      this.writeJson(this.getCachePath(this.importsCacheDir, filePath), cacheEntry);
      if (this.syncCaches && (this.importsFallbackDir != null)) {
        return this.writeJson(this.getCachePath(this.importsFallbackDir, filePath), cacheEntry);
      }
    };

    LessCache.prototype.parseLess = function(filePath, contents) {
      var css, imports, options;
      css = null;
      options = {
        filename: filePath,
        syncImport: true,
        javascriptEnabled: true,
        paths: this.importPaths
      };
      if (less === null) {
        less = require('less');
        lessFs = less.fs;
      } else if (lessFs === null) {
        lessFs = less.fs;
      }
      imports = this.observeImportedFilePaths(function() {
        return less.render(contents, options, function(error, result) {
          if (error != null) {
            throw error;
          } else {
            return css = result.css, result;
          }
        });
      });
      return {
        imports: imports,
        css: css
      };
    };

    LessCache.prototype.readFileSync = function(absoluteFilePath) {
      var lessSource, relativeFilePath;
      lessSource = null;
      if (this.resourcePath && fs.isAbsolute(absoluteFilePath)) {
        relativeFilePath = this.relativize(this.resourcePath, absoluteFilePath);
        lessSource = this.lessSourcesByRelativeFilePath[relativeFilePath];
      }
      if (lessSource != null) {
        return this.cssForFile(absoluteFilePath, lessSource.content, lessSource.digest);
      } else {
        return this.cssForFile(absoluteFilePath, fs.readFileSync(absoluteFilePath, 'utf8'));
      }
    };

    LessCache.prototype.cssForFile = function(filePath, lessContent, digest) {
      var css, imports, ref1;
      if (digest == null) {
        digest = LessCache.digestForContent(lessContent);
      }
      css = this.getCachedCss(filePath, digest);
      if (css != null) {
        this.stats.hits++;
        return css;
      }
      this.stats.misses++;
      ref1 = this.parseLess(filePath, lessContent), imports = ref1.imports, css = ref1.css;
      this.putCachedCss(filePath, digest, css, imports);
      return css;
    };

    return LessCache;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVzcy1jYWNoZS5qcyIsInNvdXJjZVJvb3QiOiIuLiIsInNvdXJjZXMiOlsibGliL2xlc3MtY2FjaGUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUFBLE1BQUEsOEdBQUE7SUFBQTs7RUFBQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFFBQVI7O0VBQ1QsTUFBK0MsT0FBQSxDQUFRLE1BQVIsQ0FBL0MsRUFBQyx1QkFBRCxFQUFXLHFCQUFYLEVBQW9CLHFCQUFwQixFQUE2QixlQUE3QixFQUFtQzs7RUFFbkMsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxpQkFBUjs7RUFDSixFQUFBLEdBQUssT0FBQSxDQUFRLFNBQVI7O0VBQ0wsSUFBQSxHQUFPOztFQUNQLE1BQUEsR0FBUzs7RUFDVCxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVIsQ0FBa0IsQ0FBQzs7RUFFN0IsWUFBQSxHQUFlOztFQUVmLE1BQU0sQ0FBQyxPQUFQLEdBQ007SUFDSixTQUFDLENBQUEsZ0JBQUQsR0FBbUIsU0FBQyxPQUFEO2FBQ2pCLE1BQU0sQ0FBQyxVQUFQLENBQWtCLE1BQWxCLENBQXlCLENBQUMsTUFBMUIsQ0FBaUMsT0FBakMsRUFBMEMsTUFBMUMsQ0FBaUQsQ0FBQyxNQUFsRCxDQUF5RCxLQUF6RDtJQURpQjs7SUFnQk4sbUJBQUMsTUFBRDs7UUFBQyxTQUFPOztNQUVqQixJQUFDLENBQUEsa0JBQUEsUUFESCxFQUNhLElBQUMsQ0FBQSxxQkFBQSxXQURkLEVBQzJCLElBQUMsQ0FBQSxzQkFBQSxZQUQ1QixFQUMwQyxJQUFDLENBQUEscUJBQUEsV0FEM0MsRUFDd0QsSUFBQyxDQUFBLG9CQUFBLFVBRHpELEVBRUUsSUFBQyxDQUFBLHVDQUFBLDZCQUZILEVBRWtDLElBQUMsQ0FBQSwrQ0FBQTs7UUFHbkMsSUFBQyxDQUFBLGdDQUFpQzs7O1FBQ2xDLElBQUMsQ0FBQSx3Q0FBeUM7O01BQzFDLElBQUMsQ0FBQSxlQUFELEdBQW1CLElBQUMsQ0FBQSx3QkFBRCxDQUEwQixJ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SUFBQyxDQUFBLFVBQUQsQ0FBWSxnQkFBWixFQUE4QixVQUFVLENBQUMsT0FBekMsRUFBa0QsVUFBVSxDQUFDLE1BQTdELEVBREY7T0FBQSxNQUFBO2VBR0UsSUFBQyxDQUFBLFVBQUQsQ0FBWSxnQkFBWixFQUE4QixFQUFFLENBQUMsWUFBSCxDQUFnQixnQkFBaEIsRUFBa0MsTUFBbEMsQ0FBOUIsRUFIRjs7SUFOWTs7d0JBbUJkLFVBQUEsR0FBWSxTQUFDLFFBQUQsRUFBVyxXQUFYLEVBQXdCLE1BQXhCO0FBQ1YsVUFBQTs7UUFBQSxTQUFVLFNBQVMsQ0FBQyxnQkFBVixDQUEyQixXQUEzQjs7TUFDVixHQUFBLEdBQU0sSUFBQyxDQUFBLFlBQUQsQ0FBYyxRQUFkLEVBQXdCLE1BQXhCO01BQ04sSUFBRyxXQUFIO1FBQ0UsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFQO0FBQ0EsZUFBTyxJQUZUOztNQUlBLElBQUMsQ0FBQSxLQUFLLENBQUMsTUFBUDtNQUNBLE9BQWlCLElBQUMsQ0FBQSxTQUFELENBQVcsUUFBWCxFQUFxQixXQUFyQixDQUFqQixFQUFDLHNCQUFELEVBQVU7TUFDVixJQUFDLENBQUEsWUFBRCxDQUFjLFFBQWQsRUFBd0IsTUFBeEIsRUFBZ0MsR0FBaEMsRUFBcUMsT0FBckM7YUFDQTtJQVZVOzs7OztBQW5QZCIsInNvdXJjZXNDb250ZW50IjpbImNyeXB0byA9IHJlcXVpcmUgJ2NyeXB0bydcbntiYXNlbmFtZSwgZGlybmFtZSwgZXh0bmFtZSwgam9pbiwgcmVsYXRpdmV9ID0gcmVxdWlyZSAncGF0aCdcblxuXyA9IHJlcXVpcmUgJ3VuZGVyc2NvcmUtcGx1cydcbmZzID0gcmVxdWlyZSAnZnMtcGx1cydcbmxlc3MgPSBudWxsICMgRGVmZXIgdW50aWwgaXQgaXMgYWN0dWFsbHkgdXNlZFxubGVzc0ZzID0gbnVsbCAjIERlZmVyIHVudGlsIGl0IGlzIGFjdHVhbGx5IHVzZWRcbndhbGtkaXIgPSByZXF1aXJlKCd3YWxrZGlyJykuc3luY1xuXG5jYWNoZVZlcnNpb24gPSAxXG5cbm1vZHVsZS5leHBvcnRzID1cbmNsYXNzIExlc3NDYWNoZVxuICBAZGlnZXN0Rm9yQ29udGVudDogKGNvbnRlbnQpIC0+XG4gICAgY3J5cHRvLmNyZWF0ZUhhc2goJ1NIQTEnKS51cGRhdGUoY29udGVudCwgJ3V0ZjgnKS5kaWdlc3QoJ2hleCcpXG5cbiAgIyBDcmVhdGUgYSBuZXcgTGVzcyBjYWNoZSB3aXRoIHRoZSBnaXZlbiBvcHRpb25zLlxuICAjXG4gICMgb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIGZvbGxvd2luZyBrZXlzXG4gICMgICAqIGNhY2hlRGlyOiBBIHN0cmluZyBwYXRoIHRvIHRoZSBkaXJlY3RvcnkgdG8gc3RvcmUgY2FjaGVkIGZpbGVzIGluIChyZXF1aXJlZClcbiAgI1xuICAjICAgKiBpbXBvcnRQYXRoczogQW4gYXJyYXkgb2Ygc3RyaW5ncyB0byBjb25maWd1cmUgdGhlIExlc3MgcGFyc2VyIHdpdGggKG9wdGlvbmFsKVxuICAjXG4gICMgICAqIHJlc291cmNlUGF0aDogQSBzdHJpbmcgcGF0aCB0byB1c2UgZm9yIHJlbGF0aXZpemluZyBwYXRocy4gVGhpcyBpcyB1c2VmdWwgaWZcbiAgIyAgICAgICAgICAgICAgICAgICB5b3Ugd2FudCB0byBtYWtlIGNhY2hlcyB0cmFuc2ZlcmFibGUgYmV0d2VlbiBkaXJlY3RvcmllcyBvclxuICAjICAgICAgICAgICAgICAgICAgIG1hY2hpbmVzLiAob3B0aW9uYWwpXG4gICNcbiAgIyAgICogZmFsbGJhY2tEaXI6IEEgc3RyaW5nIHBhdGggdG8gYSBkaXJlY3RvcnkgY29udGFpbmluZyBhIHJlYWRhYmxlIGNhY2hlIHRvIHJlYWRcbiAgIyAgICAgICAgICAgICAgICAgIGZyb20gYW4gZW50cnkgaXMgbm90IGZvdW5kIGluIHRoaXMgY2FjaGUgKG9wdGlvbmFsKVxuICBjb25zdHJ1Y3RvcjogKHBhcmFtcz17fSkgLT5cbiAgICB7XG4gICAgICBAY2FjaGVEaXIsIEBpbXBvcnRQYXRocywgQHJlc291cmNlUGF0aCwgQGZhbGxiYWNrRGlyLCBAc3luY0NhY2hlcyxcbiAgICAgIEBsZXNzU291cmNlc0J5UmVsYXRpdmVGaWxlUGF0aCwgQGltcG9ydGVkRmlsZVBhdGhzQnlSZWxhdGl2ZUltcG9ydFBhdGhcbiAgICB9ID0gcGFyYW1zXG5cbiAgICBAbGVzc1NvdXJjZXNCeVJlbGF0aXZlRmlsZVBhdGggPz0ge31cbiAgICBAaW1wb3J0ZWRGaWxlUGF0aHNCeVJlbGF0aXZlSW1wb3J0UGF0aCA/PSB7fVxuICAgIEBpbXBvcnRzQ2FjaGVEaXIgPSBAY2FjaGVEaXJlY3RvcnlGb3JJbXBvcnRzKEBpbXBvcnRQYXRocylcbiAgICBpZiBAZmFsbGJhY2tEaXJcbiAgICAgIEBpbXBvcnRzRmFsbGJhY2tEaXIgPSBqb2luKEBmYWxsYmFja0RpciwgYmFzZW5hbWUoQGltcG9ydHNDYWNoZURpcikpXG5cbiAgICB0cnlcbiAgICAgIHtAaW1wb3J0ZWRGaWxlc30gPSBAcmVhZEpzb24oam9pbihAaW1wb3J0c0NhY2hlRGlyLCAnaW1wb3J0cy5qc29uJykpXG5cbiAgICBAc2V0SW1wb3J0UGF0aHMoQGltcG9ydFBhdGhzKVxuXG4gICAgQHN0YXRzID1cbiAgICAgIGhpdHM6IDBcbiAgICAgIG1pc3NlczogMFxuXG4gIGNhY2hlRGlyZWN0b3J5Rm9ySW1wb3J0czogKGltcG9ydFBhdGhzPVtdKSAtPlxuICAgIGlmIEByZXNvdXJjZVBhdGhcbiAgICAgIGltcG9ydFBhdGhzID0gaW1wb3J0UGF0aHMubWFwIChpbXBvcnRQYXRoKSA9PlxuICAgICAgICBAcmVsYXRpdml6ZShAcmVzb3VyY2VQYXRoLCBpbXBvcnRQYXRoKVxuICAgIGpvaW4oQGNhY2hlRGlyLCBMZXNzQ2FjaGUuZGlnZXN0Rm9yQ29udGVudChpbXBvcnRQYXRocy5qb2luKCdcXG4nKSkpXG5cbiAgZ2V0RGlyZWN0b3J5OiAtPiBAY2FjaGVEaXJcblxuICBnZXRJbXBvcnRQYXRoczogLT4gXy5jbG9uZShAaW1wb3J0UGF0aHMpXG5cbiAgZ2V0SW1wb3J0ZWRGaWxlczogKGltcG9ydFBhdGhzKSAtPlxuICAgIGltcG9ydGVkRmlsZXMgPSBbXVxuICAgIGZvciBhYnNvbHV0ZUltcG9ydFBhdGggaW4gaW1wb3J0UGF0aHNcbiAgICAgIGltcG9ydFBhdGggPSBudWxsXG4gICAgICBpZiBAcmVzb3VyY2VQYXRoP1xuICAgICAgICBpbXBvcnRQYXRoID0gQHJlbGF0aXZpemUoQHJlc291cmNlUGF0aCwgYWJzb2x1dGVJbXBvcnRQYXRoKVxuICAgICAgZWxzZVxuICAgICAgICBpbXBvcnRQYXRoID0gYWJzb2x1dGVJbXBvcnRQYXRoXG5cbiAgICAgIGltcG9ydGVkRmlsZVBhdGhzID0gQGltcG9ydGVkRmlsZVBhdGhzQnlSZWxhdGl2ZUltcG9ydFBhdGhbaW1wb3J0UGF0aF1cbiAgICAgIGlmIGltcG9ydGVkRmlsZVBhdGhzP1xuICAgICAgICBpbXBvcnRlZEZpbGVzID0gaW1wb3J0ZWRGaWxlcy5jb25jYXQoaW1wb3J0ZWRGaWxlUGF0aHMpXG4gICAgICBlbHNlXG4gICAgICAgIHRyeVxuICAgICAgICAgIHdhbGtkaXIgYWJzb2x1dGVJbXBvcnRQYXRoLCBub19yZXR1cm46IHRydWUsIChmaWxlUGF0aCwgc3RhdCkgPT5cbiAgICAgICAgICAgIHJldHVybiB1bmxlc3Mgc3RhdC5pc0ZpbGUoKVxuICAgICAgICAgICAgaWYgQHJlc291cmNlUGF0aD9cbiAgICAgICAgICAgICAgaW1wb3J0ZWRGaWxlcy5wdXNoKEByZWxhdGl2aXplKEByZXNvdXJjZVBhdGgsIGZpbGVQYXRoKSlcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgaW1wb3J0ZWRGaWxlcy5wdXNoKGZpbGVQYXRoKVxuICAgICAgICBjYXRjaCBlcnJvclxuICAgICAgICAgIGNvbnRpbnVlXG5cbiAgICBpbXBvcnRlZEZpbGVzXG5cbiAgc2V0SW1wb3J0UGF0aHM6IChpbXBvcnRQYXRocz1bXSkgLT5cbiAgICBpbXBvcnRlZEZpbGVzID0gQGdldEltcG9ydGVkRmlsZXMoaW1wb3J0UGF0aHMpXG5cbiAgICBwYXRoc0NoYW5nZWQgPSBub3QgXy5pc0VxdWFsKEBpbXBvcnRQYXRocywgaW1wb3J0UGF0aHMpXG4gICAgZmlsZXNDaGFuZ2VkID0gbm90IF8uaXNFcXVhbChAaW1wb3J0ZWRGaWxlcywgaW1wb3J0ZWRGaWxlcylcbiAgICBpZiBwYXRoc0NoYW5nZWRcbiAgICAgIEBpbXBvcnRzQ2FjaGVEaXIgPSBAY2FjaGVEaXJlY3RvcnlGb3JJbXBvcnRzKGltcG9ydFBhdGhzKVxuICAgICAgaWYgQGZhbGxiYWNrRGlyXG4gICAgICAgIEBpbXBvcnRzRmFsbGJhY2tEaXIgPSBqb2luKEBmYWxsYmFja0RpciwgYmFzZW5hbWUoQGltcG9ydHNDYWNoZURpcikpXG4gICAgZWxzZSBpZiBmaWxlc0NoYW5nZWRcbiAgICAgIHRyeVxuICAgICAgICBmcy5yZW1vdmVTeW5jKEBpbXBvcnRzQ2FjaGVEaXIpXG4gICAgICBjYXRjaCBlcnJvclxuICAgICAgICBpZiBlcnJvcj8uY29kZSBpcyAnRU5PRU5UJ1xuICAgICAgICAgIHRyeVxuICAgICAgICAgICAgZnMucmVtb3ZlU3luYyhAaW1wb3J0c0NhY2hlRGlyKSAjIFJldHJ5IG9uY2VcblxuICAgIEB3cml0ZUpzb24oam9pbihAaW1wb3J0c0NhY2hlRGlyLCAnaW1wb3J0cy5qc29uJyksIHtpbXBvcnRlZEZpbGVzfSlcblxuICAgIEBpbXBvcnRlZEZpbGVzID0gaW1wb3J0ZWRGaWxlc1xuICAgIEBpbXBvcnRQYXRocyA9IGltcG9ydFBhdGhzXG5cbiAgb2JzZXJ2ZUltcG9ydGVkRmlsZVBhdGhzOiAoY2FsbGJhY2spIC0+XG4gICAgaW1wb3J0ZWRQYXRocyA9IFtdXG4gICAgIyBsb2FkIG9yIGFzc2lnbiBsZXNzIGFuZCBsZXNzRnNcbiAgICBpZiAobGVzcyA9PSBudWxsKVxuICAgICAgbGVzcyA9IHJlcXVpcmUgJ2xlc3MnXG4gICAgICBsZXNzRnMgPSBsZXNzLmZzXG4gICAgZWxzZSBpZiAobGVzc0ZzID09IG51bGwpXG4gICAgICBsZXNzRnMgPSBsZXNzLmZzXG4gICAgb3JpZ2luYWxGc1JlYWRGaWxlU3luYyA9IGxlc3NGcy5yZWFkRmlsZVN5bmNcbiAgICBsZXNzRnMucmVhZEZpbGVTeW5jID0gKGZpbGVQYXRoLCBhcmdzLi4uKSA9PlxuICAgICAgcmVsYXRpdmVGaWxlUGF0aCA9IEByZWxhdGl2aXplKEByZXNvdXJjZVBhdGgsIGZpbGVQYXRoKSBpZiBAcmVzb3VyY2VQYXRoXG4gICAgICBsZXNzU291cmNlID0gQGxlc3NTb3VyY2VzQnlSZWxhdGl2ZUZpbGVQYXRoW3JlbGF0aXZlRmlsZVBhdGhdXG4gICAgICBjb250ZW50ID0gbnVsbFxuICAgICAgZGlnZXN0ID0gbnVsbFxuICAgICAgaWYgbGVzc1NvdXJjZT9cbiAgICAgICAgY29udGVudCA9IGxlc3NTb3VyY2UuY29udGVudFxuICAgICAgICBkaWdlc3QgPSBsZXNzU291cmNlLmRpZ2VzdFxuICAgICAgZWxzZVxuICAgICAgICBjb250ZW50ID0gb3JpZ2luYWxGc1JlYWRGaWxlU3luYyhmaWxlUGF0aCwgYXJncy4uLilcbiAgICAgICAgZGlnZXN0ID0gTGVzc0NhY2hlLmRpZ2VzdEZvckNvbnRlbnQoY29udGVudClcblxuICAgICAgaW1wb3J0ZWRQYXRocy5wdXNoKHtwYXRoOiByZWxhdGl2ZUZpbGVQYXRoID8gZmlsZVBhdGgsIGRpZ2VzdDogZGlnZXN0fSlcbiAgICAgIGNvbnRlbnRcblxuICAgIHRyeVxuICAgICAgY2FsbGJhY2soKVxuICAgIGZpbmFsbHlcbiAgICAgIGxlc3NGcy5yZWFkRmlsZVN5bmMgPSBvcmlnaW5hbEZzUmVhZEZpbGVTeW5jXG5cbiAgICBpbXBvcnRlZFBhdGhzXG5cbiAgcmVhZEpzb246IChmaWxlUGF0aCkgLT4gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgpKVxuXG4gIHdyaXRlSnNvbjogKGZpbGVQYXRoLCBvYmplY3QpIC0+IGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KG9iamVjdCkpXG5cbiAgZGlnZXN0Rm9yUGF0aDogKHJlbGF0aXZlRmlsZVBhdGgpIC0+XG4gICAgbGVzc1NvdXJjZSA9IEBsZXNzU291cmNlc0J5UmVsYXRpdmVGaWxlUGF0aFtyZWxhdGl2ZUZpbGVQYXRoXVxuICAgIGlmIGxlc3NTb3VyY2U/XG4gICAgICBsZXNzU291cmNlLmRpZ2VzdFxuICAgIGVsc2VcbiAgICAgIGFic29sdXRlRmlsZVBhdGggPSBudWxsXG4gICAgICBpZiBAcmVzb3VyY2VQYXRoIGFuZCBub3QgZnMuaXNBYnNvbHV0ZShyZWxhdGl2ZUZpbGVQYXRoKVxuICAgICAgICBhYnNvbHV0ZUZpbGVQYXRoID0gam9pbihAcmVzb3VyY2VQYXRoLCByZWxhdGl2ZUZpbGVQYXRoKVxuICAgICAgZWxzZVxuICAgICAgICBhYnNvbHV0ZUZpbGVQYXRoID0gcmVsYXRpdmVGaWxlUGF0aFxuICAgICAgTGVzc0NhY2hlLmRpZ2VzdEZvckNvbnRlbnQoZnMucmVhZEZpbGVTeW5jKGFic29sdXRlRmlsZVBhdGgpKVxuXG4gIHJlbGF0aXZpemU6IChmcm9tLCB0bykgLT5cbiAgICByZWxhdGl2ZVBhdGggPSByZWxhdGl2ZShmcm9tLCB0bylcbiAgICBpZiByZWxhdGl2ZVBhdGguaW5kZXhPZignLi4nKSBpcyAwXG4gICAgICB0b1xuICAgIGVsc2VcbiAgICAgIHJlbGF0aXZlUGF0aFxuXG4gIGdldENhY2hlUGF0aDogKGRpcmVjdG9yeSwgZmlsZVBhdGgpIC0+XG4gICAgY2FjaGVGaWxlID0gXCIje2Jhc2VuYW1lKGZpbGVQYXRoLCBleHRuYW1lKGZpbGVQYXRoKSl9Lmpzb25cIlxuICAgIGRpcmVjdG9yeVBhdGggPSBkaXJuYW1lKGZpbGVQYXRoKVxuICAgIGRpcmVjdG9yeVBhdGggPSBAcmVsYXRpdml6ZShAcmVzb3VyY2VQYXRoLCBkaXJlY3RvcnlQYXRoKSBpZiBAcmVzb3VyY2VQYXRoXG4gICAgZGlyZWN0b3J5UGF0aCA9IExlc3NDYWNoZS5kaWdlc3RGb3JDb250ZW50KGRpcmVjdG9yeVBhdGgpIGlmIGRpcmVjdG9yeVBhdGhcbiAgICBqb2luKGRpcmVjdG9yeSwgJ2NvbnRlbnQnLCBkaXJlY3RvcnlQYXRoLCBjYWNoZUZpbGUpXG5cbiAgZ2V0Q2FjaGVkQ3NzOiAoZmlsZVBhdGgsIGRpZ2VzdCkgLT5cbiAgICB0cnlcbiAgICAgIGNhY2hlRW50cnkgPSBAcmVhZEpzb24oQGdldENhY2hlUGF0aChAaW1wb3J0c0NhY2hlRGlyLCBmaWxlUGF0aCkpXG4gICAgY2F0Y2ggZXJyb3JcbiAgICAgIGlmIEBpbXBvcnRzRmFsbGJhY2tEaXI/XG4gICAgICAgIHRyeVxuICAgICAgICAgIGNhY2hlRW50cnkgPSBAcmVhZEpzb24oQGdldENhY2hlUGF0aChAaW1wb3J0c0ZhbGxiYWNrRGlyLCBmaWxlUGF0aCkpXG4gICAgICAgICAgZmFsbGJhY2tEaXJVc2VkID0gdHJ1ZVxuXG4gICAgcmV0dXJuIHVubGVzcyBkaWdlc3QgaXMgY2FjaGVFbnRyeT8uZGlnZXN0XG5cbiAgICBmb3Ige3BhdGgsIGRpZ2VzdH0gaW4gY2FjaGVFbnRyeS5pbXBvcnRzXG4gICAgICB0cnlcbiAgICAgICAgcmV0dXJuIGlmIEBkaWdlc3RGb3JQYXRoKHBhdGgpIGlzbnQgZGlnZXN0XG4gICAgICBjYXRjaCBlcnJvclxuICAgICAgICByZXR1cm5cblxuICAgIGlmIEBzeW5jQ2FjaGVzXG4gICAgICBpZiBmYWxsYmFja0RpclVzZWRcbiAgICAgICAgQHdyaXRlSnNvbihAZ2V0Q2FjaGVQYXRoKEBpbXBvcnRzQ2FjaGVEaXIsIGZpbGVQYXRoKSwgY2FjaGVFbnRyeSlcbiAgICAgIGVsc2UgaWYgQGltcG9ydHNGYWxsYmFja0Rpcj9cbiAgICAgICAgQHdyaXRlSnNvbihAZ2V0Q2FjaGVQYXRoKEBpbXBvcnRzRmFsbGJhY2tEaXIsIGZpbGVQYXRoKSwgY2FjaGVFbnRyeSlcblxuICAgIGNhY2hlRW50cnkuY3NzXG5cbiAgcHV0Q2FjaGVkQ3NzOiAoZmlsZVBhdGgsIGRpZ2VzdCwgY3NzLCBpbXBvcnRzKSAtPlxuICAgIGNhY2hlRW50cnkgPSB7ZGlnZXN0LCBjc3MsIGltcG9ydHMsIHZlcnNpb246IGNhY2hlVmVyc2lvbn1cbiAgICBAd3JpdGVKc29uKEBnZXRDYWNoZVBhdGgoQGltcG9ydHNDYWNoZURpciwgZmlsZVBhdGgpLCBjYWNoZUVudHJ5KVxuXG4gICAgaWYgQHN5bmNDYWNoZXMgYW5kIEBpbXBvcnRzRmFsbGJhY2tEaXI/XG4gICAgICBAd3JpdGVKc29uKEBnZXRDYWNoZVBhdGgoQGltcG9ydHNGYWxsYmFja0RpciwgZmlsZVBhdGgpLCBjYWNoZUVudHJ5KVxuXG4gIHBhcnNlTGVzczogKGZpbGVQYXRoLCBjb250ZW50cykgLT5cbiAgICBjc3MgPSBudWxsXG4gICAgb3B0aW9ucyA9IGZpbGVuYW1lOiBmaWxlUGF0aCwgc3luY0ltcG9ydDogdHJ1ZSwgamF2YXNjcmlwdEVuYWJsZWQ6IHRydWUsIHBhdGhzOiBAaW1wb3J0UGF0aHNcbiAgICAjIGxvYWQgb3IgYXNzaWduIGxlc3MgYW5kIGxlc3NGc1xuICAgIGlmIChsZXNzID09IG51bGwpXG4gICAgICBsZXNzID0gcmVxdWlyZSAnbGVzcydcbiAgICAgIGxlc3NGcyA9IGxlc3MuZnNcbiAgICBlbHNlIGlmIChsZXNzRnMgPT0gbnVsbClcbiAgICAgIGxlc3NGcyA9IGxlc3MuZnNcbiAgICBpbXBvcnRzID0gQG9ic2VydmVJbXBvcnRlZEZpbGVQYXRocyAtPlxuICAgICAgbGVzcy5yZW5kZXIgY29udGVudHMsIG9wdGlvbnMsIChlcnJvciwgcmVzdWx0KSAtPlxuICAgICAgICBpZiBlcnJvcj9cbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICBlbHNlXG4gICAgICAgICAge2Nzc30gPSByZXN1bHRcbiAgICB7aW1wb3J0cywgY3NzfVxuXG4gICMgUmVhZCB0aGUgTGVzcyBmaWxlIGF0IHRoZSBjdXJyZW50IHBhdGggYW5kIHJldHVybiBlaXRoZXIgdGhlIGNhY2hlZCBDU1Mgb3IgdGhlIG5ld2x5XG4gICMgY29tcGlsZWQgQ1NTLiBUaGlzIG1ldGhvZCBjYWNoZXMgdGhlIGNvbXBpbGVkIENTUyBhZnRlciBpdCBpcyBnZW5lcmF0ZWQuIFRoaXMgY2FjaGVkXG4gICMgQ1NTIHdpbGwgYmUgcmV0dXJuZWQgYXMgbG9uZyBhcyB0aGUgTGVzcyBmaWxlIGFuZCBhbnkgb2YgaXRzIGltcG9ydHMgYXJlIHVuY2hhbmdlZC5cbiAgI1xuICAjIGZpbGVQYXRoOiBBIHN0cmluZyBwYXRoIHRvIGEgTGVzcyBmaWxlLlxuICAjXG4gICMgUmV0dXJucyB0aGUgY29tcGlsZWQgQ1NTIGZvciB0aGUgZ2l2ZW4gcGF0aC5cbiAgcmVhZEZpbGVTeW5jOiAoYWJzb2x1dGVGaWxlUGF0aCkgLT5cbiAgICBsZXNzU291cmNlID0gbnVsbFxuICAgIGlmIEByZXNvdXJjZVBhdGggYW5kIGZzLmlzQWJzb2x1dGUoYWJzb2x1dGVGaWxlUGF0aClcbiAgICAgIHJlbGF0aXZlRmlsZVBhdGggPSBAcmVsYXRpdml6ZShAcmVzb3VyY2VQYXRoLCBhYnNvbHV0ZUZpbGVQYXRoKVxuICAgICAgbGVzc1NvdXJjZSA9IEBsZXNzU291cmNlc0J5UmVsYXRpdmVGaWxlUGF0aFtyZWxhdGl2ZUZpbGVQYXRoXVxuXG4gICAgaWYgbGVzc1NvdXJjZT9cbiAgICAgIEBjc3NGb3JGaWxlKGFic29sdXRlRmlsZVBhdGgsIGxlc3NTb3VyY2UuY29udGVudCwgbGVzc1NvdXJjZS5kaWdlc3QpXG4gICAgZWxzZVxuICAgICAgQGNzc0ZvckZpbGUoYWJzb2x1dGVGaWxlUGF0aCwgZnMucmVhZEZpbGVTeW5jKGFic29sdXRlRmlsZVBhdGgsICd1dGY4JykpXG5cbiAgIyBSZXR1cm4gZWl0aGVyIGNhY2hlZCBDU1Mgb3IgdGhlIG5ld2x5XG4gICMgY29tcGlsZWQgQ1NTIGZyb20gYGxlc3NDb250ZW50YC4gVGhpcyBtZXRob2QgY2FjaGVzIHRoZSBjb21waWxlZCBDU1MgYWZ0ZXIgaXQgaXMgZ2VuZXJhdGVkLiBUaGlzIGNhY2hlZFxuICAjIENTUyB3aWxsIGJlIHJldHVybmVkIGFzIGxvbmcgYXMgdGhlIExlc3MgZmlsZSBhbmQgYW55IG9mIGl0cyBpbXBvcnRzIGFyZSB1bmNoYW5nZWQuXG4gICNcbiAgIyBmaWxlUGF0aDogQSBzdHJpbmcgcGF0aCB0byB0aGUgTGVzcyBmaWxlLlxuICAjIGxlc3NDb250ZW50OiBUaGUgY29udGVudHMgb2YgdGhlIGZpbGVQYXRoXG4gICNcbiAgIyBSZXR1cm5zIHRoZSBjb21waWxlZCBDU1MgZm9yIHRoZSBnaXZlbiBwYXRoIGFuZCBsZXNzQ29udGVudFxuICBjc3NGb3JGaWxlOiAoZmlsZVBhdGgsIGxlc3NDb250ZW50LCBkaWdlc3QpIC0+XG4gICAgZGlnZXN0ID89IExlc3NDYWNoZS5kaWdlc3RGb3JDb250ZW50KGxlc3NDb250ZW50KVxuICAgIGNzcyA9IEBnZXRDYWNoZWRDc3MoZmlsZVBhdGgsIGRpZ2VzdClcbiAgICBpZiBjc3M/XG4gICAgICBAc3RhdHMuaGl0cysrXG4gICAgICByZXR1cm4gY3NzXG5cbiAgICBAc3RhdHMubWlzc2VzKytcbiAgICB7aW1wb3J0cywgY3NzfSA9IEBwYXJzZUxlc3MoZmlsZVBhdGgsIGxlc3NDb250ZW50KVxuICAgIEBwdXRDYWNoZWRDc3MoZmlsZVBhdGgsIGRpZ2VzdCwgY3NzLCBpbXBvcnRzKVxuICAgIGNzc1xuIl19
//# sourceURL=/home/alex/bin/less-cache-ng/lib/less-cache.coffee